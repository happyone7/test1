# Soulspire - Stage 1 맵 레이아웃 설계

| 항목 | 내용 |
|------|------|
| 문서 버전 | 1.0 |
| 최종 수정 | 2026-02-15 |
| 작성자 | 기획팀장 (Game Designer) |
| 기준 문서 | `GDD.md` v2.0, `InGameCombat_v0.1.md` v0.2, `ArtDirection_v0.1.md` v0.1, `DifficultyDesign.md` v1.0 |
| 대상 독자 | 프로그래밍팀장, TA팀장, QA팀장 |
| 상태 | 초안 |

---

## 1. 맵 개요

| 항목 | 값 | 비고 |
|------|-----|------|
| 스테이지 이름 | 잊혀진 초원 (Forgotten Meadow) | ArtDirection 스테이지 1 테마 |
| 그리드 크기 | 16 x 12 타일 (가로 x 세로) | 가로로 넓은 직사각형 |
| 타일 크기 | 1x1 Unity Unit (32x32 px, PPU 32) | InGameCombat 2.1 기준 |
| 경로 형태 | 단일 경로, S자형 굴곡 | 스테이지 1~3은 단일 경로 |
| 배치 가능 칸 | 12칸 | InGameCombat 2.1 기준 (초기) |
| 환경 색조 | 차가운 청록 (`#102020`) | ArtDirection 4.3 기준 |

---

## 2. ASCII 맵

좌표계: (x, y) = (열, 행), 왼쪽 위가 (0, 11), 오른쪽 아래가 (15, 0)

### 2.1 범례

| 기호 | 타일 종류 | 설명 |
|------|----------|------|
| `W` | Wall | 벽/장애물 (배치 불가, 이동 불가) |
| `P` | Path | 경로 (Node 이동 경로, 배치 불가) |
| `B` | Buildable | 배치 가능 칸 (타워 배치 가능) |
| `E` | Entrance | 입구 (Node 스폰 지점) |
| `C` | Core | 코어/기지 (Node 목적지) |
| `.` | Empty | 빈 타일 (배경, 배치 불가) |
| `D` | Decoration | 장식 타일 (배경 디테일, 배치 불가) |
| `b` | Buildable (확장) | 스킬 트리 해금 후 활성화되는 추가 배치 칸 |

### 2.2 맵 전체도 (16x12)

`b` = 확장 배치 칸 (스킬 트리 해금 후 활성화, 초기에는 빈 타일처럼 보임)

```
     0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15
11:  W  W  W  W  W  W  W  W  W  W  W  W  W  W  W  W
10:  W  .  .  .  .  .  .  .  .  .  .  .  .  .  .  W
 9:  W  .  B  .  P  P  P  P  P  P  P  P  .  B  .  W
 8:  W  .  B  .  P  .  .  .  .  .  .  P  .  B  .  W
 7:  W  .  .  .  P  .  B  B  B  B  .  P  .  .  .  W
 6:  E  P  P  P  P  .  b  .  .  b  .  P  P  P  P  C
 5:  W  .  .  .  .  .  B  B  B  B  .  .  .  .  .  W
 4:  W  .  b  .  .  .  .  .  .  .  .  .  .  b  .  W
 3:  W  .  .  .  .  .  .  .  .  .  .  .  .  .  .  W
 2:  W  .  .  D  .  .  .  D  .  .  D  .  .  .  .  W
 1:  W  .  .  .  .  D  .  .  .  D  .  .  .  D  .  W
 0:  W  W  W  W  W  W  W  W  W  W  W  W  W  W  W  W
```

### 2.3 설계 의도

경로는 좌측 입구(E)에서 시작하여 상방으로 올라간 뒤 우측으로 횡단, 다시 하방으로 내려와 코어(C)에 도달하는 **U자형** 굴곡 경로이다. 이 구조의 장점은 다음과 같다.

1. **경로 길이 확보**: 직선 16칸이 아닌 약 24칸 거리로, Arrow Tower가 Node를 충분히 타격할 시간 확보
2. **경로 양옆 배치**: 배치 칸이 경로 바로 옆에 위치하여, 모든 배치 칸에서 경로 내 Node를 사거리 안에 두기 용이
3. **중앙 배치 클러스터**: 맵 정가운데에 B칸 8개가 2x4 형태로 밀집 -- 초보자가 직관적으로 타워를 놓을 핵심 영역
4. **FTUE 자동 배치 위치**: 첫 런 시 Arrow Tower는 (7, 7) 또는 (8, 7)에 자동 배치 (경로 인접, 맵 정가운데)

---

## 3. 경로 정의

### 3.1 웨이포인트 좌표 목록

Node 이동은 웨이포인트 기반이다 (InGameCombat 8.1). 타일 좌표의 중심점(+0.5, +0.5 오프셋)을 웨이포인트로 사용한다.

| 순서 | 타일 좌표 (x, y) | 월드 좌표 (x, y) | 구간 설명 |
|------|-----------------|-----------------|----------|
| Spawn | (0, 6) | (0.5, 6.5) | 입구 (E) - 맵 좌측 중앙 |
| WP1 | (1, 6) | (1.5, 6.5) | 우측 직진 |
| WP2 | (4, 6) | (4.5, 6.5) | 첫 직선 끝 |
| WP3 | (4, 9) | (4.5, 9.5) | 상방 꺾임 (첫 코너) |
| WP4 | (11, 9) | (11.5, 9.5) | 상단 횡단 끝 |
| WP5 | (11, 6) | (11.5, 6.5) | 하방 꺾임 (두번째 코너) |
| WP6 | (15, 6) | (15.5, 6.5) | 코어(C) 도달 |

### 3.2 경로 타일 전체 좌표

경로를 구성하는 모든 P 타일 좌표:

```
구간 1 (입구 -> WP2, 횡이동): (0,6), (1,6), (2,6), (3,6), (4,6)
구간 2 (WP2 -> WP3, 상방이동): (4,7), (4,8), (4,9)
구간 3 (WP3 -> WP4, 횡이동):  (5,9), (6,9), (7,9), (8,9), (9,9), (10,9), (11,9)
구간 4 (WP4 -> WP5, 하방이동): (11,8), (11,7), (11,6)
구간 5 (WP5 -> Core, 횡이동):  (12,6), (13,6), (14,6), (15,6)
```

총 경로 타일 수: 5 + 3 + 7 + 3 + 4 = **22타일**

### 3.3 경로 길이와 밸런스

| 항목 | 값 | 비고 |
|------|-----|------|
| 경로 총 타일 수 | 22 | 직선 대비 1.38배 |
| Bit Node 이동속도 | 1.5 unit/s | GDD 6.3 기준 |
| Quick Node 이동속도 | 3.0 unit/s | GDD 6.3 기준 |
| Bit Node 전체 경로 통과 시간 | ~14.7초 | 22 / 1.5 |
| Quick Node 전체 경로 통과 시간 | ~7.3초 | 22 / 3.0 |
| Arrow Tower 사거리 | 3.5 unit | GDD 5.2 T01 Lv1 기준 |

경로 중앙부를 지나는 Node는 중앙 배치 클러스터의 모든 B칸(6~9열)에서 사거리 안에 든다. 초보자가 중앙에 타워를 놓으면 자연스럽게 최적 효율을 얻는 구조.

---

## 4. 배치 가능 칸 (Buildable)

### 4.1 좌표 목록

| # | 타일 좌표 (x, y) | 위치 설명 | 인접 경로 구간 | 전략적 역할 |
|---|-----------------|----------|--------------|-----------|
| B1 | (2, 9) | 좌상단 | 구간3 (상단 횡단) | 상단 경로 초반 수비 |
| B2 | (2, 8) | 좌중단 | 구간2 (상방 이동) | 상방 코너 수비 |
| B3 | (13, 9) | 우상단 | 구간3 (상단 횡단) | 상단 경로 후반 수비 |
| B4 | (13, 8) | 우중단 | 구간4 (하방 이동) | 하방 코너 수비 |
| B5 | (6, 7) | 중앙 좌상 | 구간3 (상단) | 중앙 클러스터 - 상단 커버 |
| B6 | (7, 7) | 중앙 우상 | 구간3 (상단) | **FTUE 기본 배치 위치 (우선)** |
| B7 | (8, 7) | 중앙 좌하 | 구간3 (상단) | 중앙 클러스터 - 상단 커버 |
| B8 | (9, 7) | 중앙 우하 | 구간3 (상단) | 중앙 클러스터 |
| B9 | (6, 5) | 중앙 하좌 | 구간1 (하단) 근접 | 중앙 클러스터 - 하단 커버 |
| B10 | (7, 5) | 중앙 하중 | 구간1 (하단) 근접 | 중앙 클러스터 |
| B11 | (8, 5) | 중앙 하우 | 구간1 (하단) 근접 | 중앙 클러스터 |
| B12 | (9, 5) | 중앙 하우2 | 구간1 (하단) 근접 | 중앙 클러스터 |
| B13 | (9, 6) | 중앙 우 | 구간1 (하단 직선) | 경로 바로 옆 |
| B14 | (6, 6) | 중앙 좌 | 구간1 (하단 직선) | 경로 바로 옆 |
| B15 | (2, 4) | 좌하단 | 구간1 근접 | 하단 경로 초반 수비 |
| B16 | (13, 4) | 우하단 | 구간5 근접 | 코어 방어 최종 라인 |

**주의**: 초기 상태 배치 칸은 12개이다. B1~B12가 기본 배치 칸이며, B13~B16은 스킬 트리 "타워 슬롯 확장" (+4칸/회) 해금 시 추가된다.

### 4.2 배치 칸 분류

| 분류 | 칸 번호 | 수량 | 설명 |
|------|--------|------|------|
| 중앙 클러스터 (상) | B5, B6, B7, B8 | 4 | 경로 상단 횡단부 커버. 핵심 배치 영역 |
| 중앙 클러스터 (하) | B9, B10, B11, B12 | 4 | 경로 하단 입구부 근접 커버 |
| 외곽 (좌) | B1, B2 | 2 | 경로 좌측 코너 수비 |
| 외곽 (우) | B3, B4 | 2 | 경로 우측 코너 수비 |
| **기본 합계** | B1~B12 | **12** | InGameCombat 기준 초기 배치 칸 수 |
| 확장 | B13, B14, B15, B16 | 4 | 스킬 트리 1회 확장 시 추가 |

### 4.3 FTUE 자동 배치

첫 런 시 Arrow Tower 1기가 **B6 (7, 7)** 에 자동 배치된다.

- 맵의 정가운데 (16/2=8, 12/2=6 -> 7열 7행은 거의 정중앙)
- 경로 상단 횡단부(y=9)와 하단 직선(y=6) 모두 사거리(3.5) 안에 듦
- 초보자가 "타워가 Node를 잡는다"를 즉시 체험 가능

---

## 5. 벽/장애물 위치

### 5.1 외벽

맵 테두리 전체가 Wall 타일로 둘러싸여 있다.

```
행 0:  (0,0) ~ (15,0)  전체 16타일
행 11: (0,11) ~ (15,11) 전체 16타일
열 0:  (0,1) ~ (0,10)   10타일 (행6 = Entrance이므로 제외)
열 15: (15,1) ~ (15,10)  10타일 (행6 = Core이므로 제외)
```

입구(0,6)와 코어(15,6)만 벽이 열려 있다.

### 5.2 내부 장애물

내부에는 Wall 타일이 없다. 스테이지 1은 튜토리얼 수준이므로 시야를 가리거나 배치를 제한하는 내부 장애물을 두지 않는다. 대신 Decoration 타일로 분위기만 연출한다.

---

## 6. 장식 타일 (Decoration)

시각적 분위기 연출용. 게임플레이에 영향 없음.

| 타일 좌표 | 장식 종류 | 설명 |
|----------|----------|------|
| (3, 2) | 부서진 석판 | 고대 유적 잔해 |
| (7, 2) | 이끼 낀 룬석 | 잊혀진 마법진 흔적 |
| (10, 2) | 시든 관목 | 황혼 초원의 식물 |
| (5, 1) | 갈라진 돌바닥 | 환경 디테일 |
| (9, 1) | 작은 수정 조각 | 마력 잔재 |
| (13, 1) | 뒤틀린 뿌리 | 환경 디테일 |

---

## 7. 타일 종류 매핑 (Tilemap 레이어별)

### 7.1 Tilemap_Background (L1)

맵 전체를 채우는 배경 타일. 색조: 차가운 청록(`#102020`).

- 모든 비-Wall 타일에 "잊혀진 초원" 바닥 타일 배치
- Wall 위치에는 돌/유적 타일(`#2A2A3A`) 배치

### 7.2 Tilemap_Path (L3, 시각용)

경로를 시각적으로 표시하는 타일. 밝은 돌바닥(`#3A3A50`) + 약간의 룬 무늬.

```
대상 좌표: 3.2절의 경로 타일 전체 좌표 22개
```

### 7.3 Tilemap_Placement (판정용, 비가시)

타워 배치 가능 여부를 판정하는 투명 타일.

```
대상 좌표: 4.1절의 B1~B12 좌표 12개 (기본)
확장 시: B13~B16 좌표 4개 추가
```

### 7.4 Tilemap_Wall (L1)

벽/장애물 타일. 5.1절의 외벽 좌표 전체.

### 7.5 Tilemap_Decoration (L2)

6절의 장식 타일 좌표.

---

## 8. 프로그래밍팀장 전달 데이터

### 8.1 웨이포인트 Transform 좌표 (WaveSpawner용)

```csharp
// Stage1 웨이포인트 (월드 좌표, z=0)
Vector3[] stage1Waypoints = new Vector3[]
{
    new Vector3(0.5f, 6.5f, 0f),   // Spawn (입구)
    new Vector3(4.5f, 6.5f, 0f),   // WP1 (첫 직선 끝)
    new Vector3(4.5f, 9.5f, 0f),   // WP2 (상방 꺾임)
    new Vector3(11.5f, 9.5f, 0f),  // WP3 (상단 횡단 끝)
    new Vector3(11.5f, 6.5f, 0f),  // WP4 (하방 꺾임)
    new Vector3(15.5f, 6.5f, 0f),  // WP5 (코어 도달)
};

// 기지(Core) 위치
Vector3 corePosition = new Vector3(15.5f, 6.5f, 0f);

// FTUE Arrow Tower 자동 배치 위치
Vector3 ftueArrowPosition = new Vector3(7.5f, 7.5f, 0f); // B6 (7,7)
```

### 8.2 배치 가능 칸 좌표 (PlacementGrid용)

```csharp
// 기본 12칸
Vector3Int[] stage1BuildableSlots = new Vector3Int[]
{
    new Vector3Int(2, 9, 0),   // B1
    new Vector3Int(2, 8, 0),   // B2
    new Vector3Int(13, 9, 0),  // B3
    new Vector3Int(13, 8, 0),  // B4
    new Vector3Int(6, 7, 0),   // B5
    new Vector3Int(7, 7, 0),   // B6 (FTUE)
    new Vector3Int(8, 7, 0),   // B7
    new Vector3Int(9, 7, 0),   // B8
    new Vector3Int(6, 5, 0),   // B9
    new Vector3Int(7, 5, 0),   // B10
    new Vector3Int(8, 5, 0),   // B11
    new Vector3Int(9, 5, 0),   // B12
};

// 확장 4칸 (스킬 트리 "타워 슬롯 확장" 해금 시)
Vector3Int[] stage1ExpandedSlots = new Vector3Int[]
{
    new Vector3Int(9, 6, 0),   // B13
    new Vector3Int(6, 6, 0),   // B14
    new Vector3Int(2, 4, 0),   // B15
    new Vector3Int(13, 4, 0),  // B16
};
```

---

## 9. 밸런싱 검증

### 9.1 경로 길이 vs DPS 검증

DifficultyDesign.md 기준으로 경로 22타일(22 Unity Unit)에서의 검증.

**초기 상태 (영구 업그레이드 0, Arrow 1기 at B6)**

| 구간 | Node 경로 위치 | B6에서 거리 | 사거리 내? |
|------|--------------|-----------|----------|
| 구간1 (y=6) | (1~4, 6) | 1.5~3.5 | 부분적 (3,6), (4,6)만 |
| 구간2 (y=7~9) | (4, 7~9) | 3.0~3.6 | (4,7) OK, (4,8~9) 범위 밖 |
| 구간3 (y=9) | (5~11, 9) | 1.5~4.7 | (5~10, 9) 대부분 OK |
| 구간4 (y=6~8) | (11, 6~8) | 4.0~4.1 | 범위 밖 |
| 구간5 (y=6) | (12~15, 6) | 5.0~8.0 | 범위 밖 |

B6 단일 타워는 주로 **구간3 상단 횡단부**를 커버한다. 구간 3은 경로의 7타일(전체의 약 32%)로, Bit Node 기준 약 4.7초간 노출된다. Arrow Lv1 DPS 10.0으로 4.7초간 47 데미지 -- Bit Node HP 20을 2.3기 처치 가능. W1의 Bit x5 중 약 2마리 처치, 3마리 통과 -> 기지 -3 HP. 이는 DifficultyDesign의 시뮬레이션(W1에서 1~2마리 놓침)과 대체로 부합.

### 9.2 배치 칸 수 vs 난이도

| 시점 | 예상 타워 수 | 사용 배치 칸 | 여유 칸 | 상태 |
|------|-----------|-----------|--------|------|
| 첫 런 | 1~2기 | 1~2 / 12 | 10~11 | 넉넉 (튜토리얼) |
| 5회차 | 2~3기 | 2~3 / 12 | 9~10 | 넉넉 |
| 15회차 (클리어 근접) | 3~4기 | 3~4 / 12 | 8~9 | 넉넉 |
| 스킬 트리 확장 후 | 4~6기 | 4~6 / 16 | 10~12 | 충분 |

스테이지 1에서는 배치 칸 부족이 문제가 되지 않는다. 이는 의도된 설계로, 초보자에게 "칸이 부족해서 못 놓겠다"는 좌절감을 주지 않기 위함이다. 배치 칸 부족은 후반 스테이지(4+)에서 전략적 선택으로 활용한다.

### 9.3 경로 겹침/배치 칸 겹침 검증

| 검증 항목 | 결과 |
|----------|------|
| 경로 타일과 배치 칸 겹침 | 없음 (P와 B 좌표 교집합 = 공집합) |
| 경로가 입구에서 코어까지 연결됨 | 확인 (E -> P*22 -> C, 끊김 없음) |
| 배치 칸이 그리드 범위(0~15, 0~11) 안 | 확인 (모든 B 좌표가 범위 내) |
| 웨이포인트가 그리드 범위 안 | 확인 (모든 WP가 범위 내) |
| FTUE 배치 위치(B6)가 배치 가능 칸 | 확인 ((7,7) = B6) |

---

## 10. 향후 확장 노트

- **스테이지 2 이후**: 맵 크기, 경로 형태, 내부 장애물이 달라짐. 별도 MapLayout 문서로 분리.
- **다중 경로**: 스테이지 4부터 도입. 분기점/합류점 추가.
- **환경 기믹**: 후반 스테이지에서 특수 타일 (함정, 버프 존 등) 도입 가능성.

---

*이 문서는 프로그래밍팀장의 Tilemap 시스템 구현 및 에디터 플레이테스트 결과에 따라 업데이트됩니다.*
