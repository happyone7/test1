# Soulspire - 보물상자 시스템 상세 기획서

| 항목 | 내용 |
|------|------|
| 문서 버전 | 2.0 |
| 최종 수정 | 2026-02-17 |
| 작성자 | 기획팀장 (Game Designer) |
| 기준 문서 | GDD v4.0 섹션 3.5 |

## 변경 이력

| 날짜 | 버전 | 내용 |
|------|------|------|
| 2026-02-15 | 1.0 | 초안 (런 내 버프 선택지 보물상자) |
| 2026-02-17 | 2.0 | 전면 재설계 - 타워 획득 전용 보물상자로 변경 (총괄PD 확정) |

---

## 1. 시스템 개요

### 1.1 보물상자란?

보물상자는 **타워를 획득하는 유일한 방법**이다. 인게임 중 드롭되며, Hub에서 오픈하면 3개의 타워 후보 중 1개를 선택하여 획득한다.

> **총괄PD 확정 (2026-02-17)**: 타워 추가 획득은 보물상자를 통해서만 가능. 인게임 중 랜덤 획득(주로 보스 드롭), Sanctum 보물상자 메뉴에서 오픈.

**핵심 설계 의도**: 보물상자 -> 타워 선택 -> 합성/배치라는 흐름을 통해, (1) 보스 도전 동기, (2) 타워 수집 쾌감, (3) 빌드 전략의 깊이를 제공한다.

### 1.2 기존 시스템 대비 변경점

| 요소 | v1.0 (기존) | v2.0 (변경) |
|------|-----------|-----------|
| 보물상자 내용물 | 런 내 한정 버프 (3지선다) | **타워** (3지선다) |
| 오픈 장소 | 인게임 (일시정지) | **Sanctum 보물상자 메뉴** |
| 획득 경로 | Incursion 클리어 + Node 드롭 + 보스 드롭 | **보스 드롭(확정) + Node 드롭(낮은 확률)** |
| 효과 지속 | 런 내 한정 (사망 시 소멸) | **영구** (타워 소유) |

---

## 2. 보물상자 드롭 설계

### 2.1 드롭 소스별 확률

| 드롭 소스 | 확률 | 비고 |
|----------|------|------|
| 보스 Node 처치 | **100% (확정)** | 모든 Floor의 보스를 잡으면 반드시 1개 |
| 일반 Node 처치 | **1~3%** | 기본 1%, Incursion 진행에 따라 소폭 증가 |

### 2.2 한 런당 평균 보물상자 획득 수

| 시나리오 | 보스 상자 | 일반 상자 (기대값) | 합계 |
|---------|----------|-----------------|------|
| 첫 런 (W1~2 사망, 보스 미도달) | 0 | 0.1~0.3 | **~0.2개** |
| 중반 런 (W3~4 사망) | 0 | 0.3~0.7 | **~0.5개** |
| Floor 클리어 (보스 처치) | 1 | 0.5~1.5 | **~1.5~2.5개** |

**밸런싱 의도**: 첫 런에서는 상자를 얻기 어렵고, 보스까지 가야 확정 상자를 얻는다. 이것이 "보스를 잡아야 타워가 늘어난다"는 강력한 동기.

---

## 3. 보물상자 오픈 시스템

### 3.1 오픈 장소

- **Sanctum 메인 화면**에 [보물상자] 버튼 배치
- 버튼 옆에 보유 상자 수 표시: `[보물상자 x3]`
- 상자가 0개이면 버튼 비활성 (흐리게)

### 3.2 오픈 플로우

```
[보물상자 버튼 클릭]
    |
    v
[상자 열기 애니메이션 (0.8초)]
    |
    v
[3개 타워 카드 표시]
    - 각 카드: 타워 이름 + 타워 이미지 + 기본 스탯 요약
    - 카드 뒤집기/등장 연출
    |
    v
[플레이어가 1개 선택]
    |
    v
[선택 확인 이펙트 + "타워 획득!" 텍스트]
    |
    v
[타워가 인벤토리에 추가]
    - "다음 런에서 사용 가능합니다" 안내
    |
    v
[남은 상자가 있으면 "계속 열기" / "닫기" 선택]
```

### 3.3 타워 선택지 생성 규칙

| 규칙 | 설명 |
|------|------|
| 선택지 풀 | **스킬 트리에서 해금한 타워 종류**만 등장 |
| 선택지 수 | 항상 3개 |
| 중복 허용 | 같은 종류가 2~3개 등장 가능 (예: Arrow x2 + Cannon x1) |
| 미해금 타워 | 절대 등장하지 않음 |
| 초반 (Arrow만 해금) | 3개 모두 Arrow (합성용) |

**설계 의도**: 초반에는 Arrow만 나오므로 자연스럽게 합성을 유도. 스킬 트리에서 새 타워를 해금하면 보물상자의 선택지가 다양해져 "해금의 보상"을 이중으로 제공.

### 3.4 선택지 가중치

기본적으로 해금된 타워 중 균등 확률이지만, 아래 보정 적용:

| 보정 규칙 | 효과 | 설계 의도 |
|----------|------|----------|
| 최근 해금 타워 | 등장 확률 x1.5 | 새로 해금한 타워를 빨리 경험 |
| 보유 수가 적은 타워 | 등장 확률 x1.2 | 고른 수집 유도 |
| 현재 Lv가 낮은 타워 종류 | 등장 확률 x1.1 | 합성 소재 부족 보정 |

---

## 4. 타워 인벤토리 연동

### 4.1 획득 후 흐름

```
보물상자 오픈 -> 타워 선택 -> 인벤토리 추가
                                |
                                v
                    다음 런 진입 시 하단 인벤토리 바에 표시
                                |
                                v
                    드래그하여 맵에 배치 or 같은 타워 위에 합성
```

### 4.2 인벤토리 관리

- 보물상자에서 획득한 타워는 즉시 인벤토리에 저장
- 인벤토리에 동일 타워가 여러 개 있을 수 있음 (합성 재료)
- 인벤토리 최대 용량: 제한 없음 (프로토타입) / 추후 20칸 등 상한 검토

---

## 5. 밸런스 분석

### 5.1 타워 공급 속도

| 시점 | 보유 타워 수 (예상) | 근거 |
|------|-----------------|------|
| 첫 런 후 | 1기 (Arrow 기본) | 보물상자 미획득 |
| 5회 런 후 | 2~3기 | 1~2개 상자 획득 |
| S1 클리어 시 | 4~5기 | 보스 확정 상자 + 랜덤 |
| S2 클리어 시 | 6~8기 | Cannon 해금 후 다양화 |
| S5 클리어 시 | 15~20기 | 다종 타워 보유 |

### 5.2 합성 진행 속도

| 합성 목표 | 필요 타워 수 | 예상 도달 시점 |
|----------|-----------|-------------|
| Arrow Lv2 | Arrow x2 | S1 클리어 전후 |
| Arrow Lv3 | Arrow x3 (누적) | S2 진행 중 |
| Arrow Lv5 | Arrow x5 (누적) | S3~4 진행 중 |
| Cannon Lv2 | Cannon x2 | S3 진행 중 |

### 5.3 설계 의도: 보물상자가 성장의 핵심 경로

- **Soul**: 영구 업그레이드(스킬 트리)에 사용 -> 전체적인 파워 상승
- **보물상자**: 타워 수 확장 + 합성 레벨업 -> 전술적 폭 확대
- 두 경로가 상호 보완하여 성장 도파민을 극대화

---

## 6. 보물상자 UX/연출 설계

### 6.1 인게임 드롭 연출

```
보스 처치 시:
1. 보스 파괴 이펙트 (슬로우모션 1초)
2. 보물상자 아이콘이 크게 "팡!" 등장
3. 상자가 화면 하단 인벤토리 영역으로 흡수 (0.5초)
4. "보물상자 +1 (Hub에서 열기)" 알림 텍스트

일반 Node 드롭 시:
1. Node 파괴 이펙트 위에 작은 상자 아이콘 등장
2. 상자가 하단으로 흡수 (0.3초)
3. "보물상자 +1" 간단 알림
```

### 6.2 Sanctum 오픈 연출

```
[보물상자] 버튼 클릭:
1. 화면 중앙에 보물상자 3D 이미지 등장
2. 상자가 열리며 빛이 발산 (0.8초)
3. 3개의 타워 카드가 뒤집혀서 등장 (왼->오 순서, 각 0.2초)
4. 각 카드에 타워 이미지 + 이름 + 기본 DPS 표시
5. 카드 호버 시 확대 + 상세 스탯 표시
6. 카드 클릭 -> 선택 확인 이펙트
7. 선택되지 않은 2개 카드가 사라지고, 선택된 카드가 인벤토리로 이동
```

### 6.3 카드 레이아웃

```
+------------------+  +------------------+  +------------------+
|                  |  |                  |  |                  |
|  [Arrow Tower]   |  | [Cannon Tower]   |  |  [Arrow Tower]   |
|     이미지       |  |     이미지       |  |     이미지       |
|                  |  |                  |  |                  |
|  Arrow Tower     |  | Cannon Tower     |  |  Arrow Tower     |
|  DMG: 8          |  | DMG: 20 (AoE)   |  |  DMG: 8          |
|  DPS: 10.0       |  | DPS: 13.3       |  |  DPS: 10.0       |
|                  |  |                  |  |                  |
|   [ 선택 ]       |  |   [ 선택 ]       |  |   [ 선택 ]       |
+------------------+  +------------------+  +------------------+
```

---

## 7. 데이터 구조 (SO 설계)

### 7.1 TreasureChestData SO (변경)

```csharp
[CreateAssetMenu(fileName = "TreasureChest_", menuName = "Game/Treasure Chest")]
public class TreasureChestData : ScriptableObject
{
    public string chestId;
    public string chestName;
    public int choiceCount = 3;         // 선택지 수 (항상 3)
    // v2.0: 타워 선택지 생성은 런타임에 해금된 타워 풀에서 동적 생성
}
```

### 7.2 기존 ChestRewardData 폐기

v1.0의 런 내 버프 선택지 SO(TreasureChoice_*.asset)는 더 이상 사용하지 않음. 보물상자 오픈 시 해금된 TowerData 풀에서 동적으로 선택지를 생성한다.

---

## 8. 구현 우선순위

| 우선순위 | 항목 | 스프린트 |
|---------|------|---------|
| P0 | 보물상자 드롭 시스템 (보스 확정 + Node 확률) | Sprint 4 |
| P0 | Sanctum 보물상자 오픈 UI (3지선다 타워 카드) | Sprint 4 |
| P0 | 타워 선택 -> 인벤토리 추가 흐름 | Sprint 4 |
| P1 | 보물상자 드롭 연출 (이펙트, 알림) | Sprint 5 |
| P1 | 선택지 가중치 시스템 | Sprint 5 |
| P2 | 카드 연출 (뒤집기, 확대, 이동 애니메이션) | Sprint 6 |

---

## 9. 밸런스 검증 체크리스트

- [ ] 첫 런(보스 미도달)에서 보물상자 0~1개 획득하는지
- [ ] S1 클리어 런에서 보물상자 1~2개 획득하는지 (보스 1개 확정)
- [ ] S1 클리어 시점에 총 4~5기 타워 보유하는지
- [ ] Arrow만 해금된 상태에서 상자 오픈 시 Arrow 3개가 나오는지
- [ ] 새 타워 해금 후 해당 타워가 상자 선택지에 등장하는지
- [ ] 타워 공급 속도가 합성 진행을 가로막지 않는지 (너무 느리면 답답함)
- [ ] 타워 공급 속도가 너무 빨라 합성 레벨업이 trivial하지 않은지

---

*이 문서는 GDD v4.0과 연동되며, 프로토타입 테스트 결과에 따라 수치가 조정됩니다.*
